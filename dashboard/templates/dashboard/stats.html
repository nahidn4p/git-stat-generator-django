{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}{{ stats.username }} - GitHub Stats{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="mb-12 text-center animate-fade-in">
    <div class="inline-flex items-center justify-center w-24 h-24 rounded-2xl mb-6 icon-wrapper mx-auto">
        <img src="{{ stats.avatar_url }}" alt="{{ stats.username }}" class="w-20 h-20 rounded-xl">
    </div>
    <h1 class="text-5xl font-display font-bold mb-3 gradient-text">{{ stats.username }}</h1>
    <p class="text-2xl {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %} mb-8 font-medium">{{ stats.name }}</p>
    <div class="flex justify-center gap-4 flex-wrap">
        <div class="stat-badge">
            <span class="text-xl">ðŸ”¥</span>
            <div class="flex flex-col items-start">
                <span class="stat-number text-lg" style="color: var(--accent-color);">{{ stats.contributions_last_year }}</span>
                <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %} text-xs">contributions</span>
            </div>
        </div>
        <div class="stat-badge">
            <span class="text-xl">ðŸ“¦</span>
            <div class="flex flex-col items-start">
                <span class="stat-number text-lg" style="color: var(--accent-color);">{{ stats.public_repos }}</span>
                <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %} text-xs">repositories</span>
            </div>
        </div>
        <div class="stat-badge">
            <span class="text-xl">ðŸ“…</span>
            <div class="flex flex-col items-start">
                <span class="stat-number text-lg" style="color: var(--accent-color);">{% if stats.created_at %}{{ stats.created_at|date:"M Y" }}{% else %}Recent{% endif %}</span>
                <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %} text-xs">joined</span>
            </div>
        </div>
    </div>
</div>

<!-- Main Grid -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-slide-up">
    <!-- Left Column -->
    <div class="space-y-6">
        <!-- GitHub Stats Card -->
        <div class="card p-8">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <div class="icon-wrapper">
                        <svg class="w-6 h-6" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-display font-bold {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %}">GitHub Stats</h2>
                </div>
            </div>
            <div class="space-y-4 mb-6">
                <div class="flex justify-between items-center py-2 border-b border-white/10">
                    <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">Total Stars Earned</span>
                    <span class="stat-number text-xl" style="color: var(--accent-color);">{{ stats.total_stars }}</span>
                </div>
                <div class="flex justify-between items-center py-2 border-b border-white/10">
                    <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">Commits (Last Year)</span>
                    <span class="stat-number text-xl" style="color: var(--accent-color);">{{ stats.commits_last_year }}</span>
                </div>
                <div class="flex justify-between items-center py-2 border-b border-white/10">
                    <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">Pull Requests</span>
                    <span class="stat-number text-xl" style="color: var(--accent-color);">{{ stats.pull_requests_last_year }}</span>
                </div>
                <div class="flex justify-between items-center py-2 border-b border-white/10">
                    <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">Issues</span>
                    <span class="stat-number text-xl" style="color: var(--accent-color);">{{ stats.issues_last_year }}</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">Contributed To</span>
                    <span class="stat-number text-xl" style="color: var(--accent-color);">{{ stats.contributed_to }}</span>
                </div>
            </div>
            <div class="flex justify-end pt-6 border-t border-white/10">
                <div class="text-center">
                    <div class="rating-circle mx-auto mb-3">
                        <span>C+</span>
                    </div>
                    <span class="text-sm {% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %} font-medium">Rating</span>
                </div>
            </div>
        </div>

        <!-- Total Contributions Card -->
        <div class="card p-8 text-center relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 rounded-full opacity-20" style="background: radial-gradient(circle, var(--accent-color), transparent); transform: translate(30%, -30%);"></div>
            <div class="relative z-10">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-xl mb-6 icon-wrapper mx-auto">
                    <svg class="w-8 h-8" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                    </svg>
                </div>
                <div class="stat-number text-6xl mb-3 gradient-text">{{ stats.total_contributions }}</div>
                <div class="text-xl {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %} font-semibold mb-2">Total Contributions</div>
                <div class="text-sm {% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">
                    {% if stats.created_at %}
                        {{ stats.created_at|date:"M d, Y" }} - Present
                    {% else %}
                        Present
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Contribution Activity Chart -->
        <div class="card p-8">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <div class="icon-wrapper">
                        <svg class="w-6 h-6" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-display font-bold {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %}">Contribution Activity</h2>
                </div>
            </div>
            <p class="text-sm {% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %} mb-6">Daily contributions Â· Last 60 days</p>
            <div class="h-64">
                <canvas id="dailyChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Right Column -->
    <div class="space-y-6">
        <!-- Monthly Contributions Chart -->
        <div class="card p-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="icon-wrapper">
                    <svg class="w-6 h-6" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-display font-bold {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %}">Monthly Contributions</h2>
            </div>
            <p class="text-sm {% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %} mb-6">Last 12 months</p>
            <div class="h-64">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <!-- Most Used Languages -->
        <div class="card p-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="icon-wrapper">
                    <svg class="w-6 h-6" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-display font-bold {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %}">Most Used Languages</h2>
            </div>
            <div class="space-y-4">
                {% for lang in stats.languages %}
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="{% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %} font-medium">{{ lang.name }}</span>
                        <span class="stat-number" style="color: var(--accent-color);">{{ lang.percentage }}%</span>
                    </div>
                    <div class="w-full rounded-full h-3 overflow-hidden" style="background: rgba(255, 255, 255, 0.1);">
                        <div class="h-full rounded-full transition-all duration-500" style="width: {{ lang.percentage }}%; background: linear-gradient(90deg, var(--accent-color), var(--accent-light));"></div>
                    </div>
                </div>
                {% empty %}
                <p class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">No language data available</p>
                {% endfor %}
            </div>
        </div>

        <!-- Current Streak -->
        <div class="card p-8 text-center relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 rounded-full opacity-20" style="background: radial-gradient(circle, var(--accent-color), transparent); transform: translate(30%, -30%);"></div>
            <div class="relative z-10">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-xl mb-6 icon-wrapper mx-auto">
                    <span class="text-3xl">ðŸ”¥</span>
                </div>
                <div class="stat-number text-5xl mb-3 gradient-text">{{ stats.current_streak }}</div>
                <div class="text-xl {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %} font-semibold mb-2">Current Streak</div>
                {% if stats.current_streak_start and stats.current_streak_end %}
                <div class="text-sm {% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">
                    {{ stats.current_streak_start|date:"M d, Y" }} - {{ stats.current_streak_end|date:"M d, Y" }}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Longest Streak -->
        <div class="card p-8 text-center relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 rounded-full opacity-20" style="background: radial-gradient(circle, var(--accent-color), transparent); transform: translate(30%, -30%);"></div>
            <div class="relative z-10">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-xl mb-6 icon-wrapper mx-auto">
                    <svg class="w-8 h-8" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 17l-2.286-6.857L5 8l5.714-2.143L13 0z"></path>
                    </svg>
                </div>
                <div class="stat-number text-5xl mb-3 gradient-text">{{ stats.longest_streak }}</div>
                <div class="text-xl {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %} font-semibold mb-2">Longest Streak</div>
                {% if stats.longest_streak_start and stats.longest_streak_end %}
                <div class="text-sm {% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %}">
                    {{ stats.longest_streak_start|date:"M d" }} - {{ stats.longest_streak_end|date:"M d, Y" }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Badge Section -->
<div class="mt-8 card p-8 animate-slide-up">
    <div class="flex items-center gap-3 mb-6">
        <div class="icon-wrapper">
            <svg class="w-6 h-6" style="color: var(--accent-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
        </div>
        <h2 class="text-2xl font-display font-bold {% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %}">Embed Badge</h2>
    </div>
    <p class="{% if theme %}{{ theme.text_secondary }}{% else %}text-gray-400{% endif %} mb-6">Add this badge to your README:</p>
    <div class="glass-card rounded-xl p-5 mb-6">
        <code class="{% if theme %}{{ theme.text_primary }}{% else %}text-gray-100{% endif %} text-sm font-mono break-all">
            ![GitHub stats]({{ request.scheme }}://{{ request.get_host }}{% url 'badge' username=stats.username %}?theme={{ theme_id }})
        </code>
    </div>
    <div class="flex justify-center">
        <img src="{% url 'badge' username=stats.username %}?theme={{ theme_id }}" alt="GitHub Stats Badge" class="rounded-xl border border-white/20 shadow-lg">
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    Chart.defaults.font.family = 'Inter, system-ui, sans-serif';
    Chart.defaults.color = 'rgba(255, 255, 255, 0.6)';
    
    // Daily Contributions Chart
    const dailyData = {{ daily_contributions_json|safe }};
    const dailyCtx = document.getElementById('dailyChart').getContext('2d');
    new Chart(dailyCtx, {
        type: 'line',
        data: {
            labels: dailyData.map(d => {
                const date = new Date(d.date);
                return date.getDate();
            }),
            datasets: [{
                label: 'Contributions',
                data: dailyData.map(d => d.count),
                borderColor: '{{ theme.chart_line_color }}',
                backgroundColor: '{{ theme.chart_fill_color }}',
                tension: 0.5,
                fill: true,
                borderWidth: 3,
                pointRadius: 0,
                pointHoverRadius: 6,
                pointHoverBackgroundColor: '{{ theme.chart_line_color }}',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: '600'
                    },
                    bodyFont: {
                        size: 13
                    },
                    borderColor: '{{ theme.chart_line_color }}',
                    borderWidth: 1,
                    cornerRadius: 8,
                    displayColors: false,
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.5)',
                        font: {
                            size: 11
                        }
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.05)',
                        drawBorder: false
                    }
                },
                x: {
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.5)',
                        font: {
                            size: 11
                        }
                    },
                    grid: {
                        display: false
                    }
                }
            }
        }
    });

    // Monthly Contributions Chart
    const monthlyData = {{ monthly_contributions_json|safe }};
    const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
    new Chart(monthlyCtx, {
        type: 'line',
        data: {
            labels: monthlyData.map(d => {
                const [year, month] = d.month.split('-');
                const date = new Date(year, month - 1);
                return date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
            }),
            datasets: [{
                label: 'Contributions',
                data: monthlyData.map(d => d.count),
                borderColor: '{{ theme.chart_line_color }}',
                backgroundColor: '{{ theme.chart_fill_color }}',
                tension: 0.5,
                fill: true,
                borderWidth: 3,
                pointRadius: 4,
                pointHoverRadius: 8,
                pointHoverBackgroundColor: '{{ theme.chart_line_color }}',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
                pointBackgroundColor: '{{ theme.chart_line_color }}',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: '600'
                    },
                    bodyFont: {
                        size: 13
                    },
                    borderColor: '{{ theme.chart_line_color }}',
                    borderWidth: 1,
                    cornerRadius: 8,
                    displayColors: false,
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.5)',
                        font: {
                            size: 11
                        }
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.05)',
                        drawBorder: false
                    }
                },
                x: {
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.5)',
                        font: {
                            size: 11
                        }
                    },
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
</script>
{% endblock %}
